<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prayer Times</title>

  <!-- Fonts + Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>

  <!-- Styles -->
  <style>
    /* كل الـ CSS الأصلي كما هو بلا تغيير */
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);color:#fff;min-height:100vh;overflow-x:hidden}
    .container{max-width:1200px;margin:0 auto;min-height:100vh;position:relative;display:flex;flex-direction:column;padding:0 20px}
    .bg-pattern{position:absolute;inset:0;background:radial-gradient(circle at 50% 50%,rgba(59,130,246,.1),transparent 50%);pointer-events:none}
    .header{display:flex;justify-content:space-between;align-items:center;padding:20px 0;font-size:16px;font-weight:500}
    .header-left{display:flex;align-items:center;gap:16px}
    .logo{font-size:24px;font-weight:700;display:flex;align-items:center;gap:10px}
    .city-info{text-align:center;padding:24px 20px;margin-bottom:20px}
    .city-name{font-size:32px;font-weight:300;letter-spacing:.05em;margin-bottom:8px}
    .islamic-date{font-size:14px;color:#94a3b8;font-weight:500;margin-bottom:4px}
    .gregorian-date{font-size:12px;color:#64748b}
    .main-content{display:flex;flex-direction:column;align-items:center;flex:1;margin-bottom:50px}
    @media (min-width:768px){.main-content{flex-direction:row;gap:30px;justify-content:center;align-items:flex-start}}
    .prayer-times-grid{display:flex;gap:16px;padding:0 20px;margin-bottom:32px;width:100%;max-width:600px}
    .prayer-card{flex:1;background-color:rgba(255,255,255,.1);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.2);border-radius:16px;padding:16px;text-align:center;transition:.3s}
    .prayer-card.active{border-color:rgba(96,165,250,.5);animation:pulse 2s infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(96,165,250,.5)}70%{box-shadow:0 0 0 10px rgba(96,165,250,0)}100%{box-shadow:0 0 0 0 rgba(96,165,250,0)}}
    .prayer-header{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px}
    .prayer-name{font-size:14px;color:#cbd5e1;font-weight:500}
    .prayer-time{font-size:18px;font-weight:600;font-family:'Inter',monospace}
    .countdown-timer{text-align:center;padding:32px 0;margin:0 auto}
    .next-prayer-text{font-size:16px;font-weight:500;color:#94a3b8;margin-bottom:16px}
    .countdown-display{font-size:48px;font-weight:300;font-family:'Inter',monospace;letter-spacing:.05em;color:#60a5fa}
    .prayer-circle{display:flex;justify-content:center;padding:32px 0}
    .circle-container{position:relative;width:288px;height:288px}
    .outer-circle{width:100%;height:100%;border-radius:50%;background:conic-gradient(from 0deg,rgba(96,165,250,.2)0%,rgba(167,139,250,.2)50%,rgba(96,165,250,.2)100%);display:flex;align-items:center;justify-content:center}
    .inner-circle{width:240px;height:240px;border-radius:50%;background-color:rgba(0,0,0,.3);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;position:relative}
    .circle-content{text-align:center}
    .circle-label{font-size:14px;color:#94a3b8;margin-bottom:4px}
    .circle-prayer{font-size:18px;font-weight:600}
    .bottom-prayer-times{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:0 20px;margin-bottom:24px;width:100%;max-width:600px}
    @media(min-width:640px){.bottom-prayer-times{grid-template-columns:repeat(4,1fr)}}
    .bottom-prayer-card{background-color:rgba(0,0,0,.3);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px;text-align:center;transition:.3s}
    .bottom-prayer-card:hover{background-color:rgba(0,0,0,.4)}
    .bottom-prayer-header{display:flex;align-items:center;justify-content:center;gap:4px;margin-bottom:8px}
    .bottom-prayer-name{font-size:12px;color:#94a3b8;font-weight:500}
    .bottom-prayer-time{font-size:14px;font-weight:600;font-family:'Inter',monospace}
  </style>
</head>
<body>
  <div class="container">
    <div class="bg-pattern"></div>

    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo">
          <i data-lucide="prayer" width="24" height="24"></i><span>Prayer Times</span>
        </div>
      </div>
    </header>

    <!-- City / Date block -->
    <div class="city-info">
      <h1 class="city-name" id="cityName">—</h1>
      <p class="islamic-date" id="islamicDate">—</p>
      <p class="gregorian-date" id="gregorianDate">—</p>
    </div>

    <!-- Main -->
    <div class="main-content">
      <div id="homeScreen">
        <!-- Top grid -->
        <div class="prayer-times-grid">
          <div class="prayer-card"><div class="prayer-header"><i data-lucide="sunrise" width="18" height="18"></i><span class="prayer-name">Fajr</span></div><div class="prayer-time" id="timeFajr">--:--</div></div>
          <div class="prayer-card"><div class="prayer-header"><i data-lucide="sun" width="18" height="18"></i><span class="prayer-name">Sunrise</span></div><div class="prayer-time" id="timeSunrise">--:--</div></div>
        </div>

        <!-- Countdown -->
        <div class="countdown-timer">
          <h3 class="next-prayer-text" id="nextPrayerLabel">Next prayer in</h3>
          <div class="countdown-display" id="countdown">--:--:--</div>
        </div>

        <!-- Circle -->
        <div class="prayer-circle">
          <div class="circle-container">
            <div class="outer-circle">
              <div class="inner-circle" id="prayerCircle">
                <div class="circle-content">
                  <div class="circle-label">Current</div>
                  <div class="circle-prayer" id="currentPrayer">—</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom grid -->
        <div class="bottom-prayer-times">
          <div class="bottom-prayer-card"><div class="bottom-prayer-header"><i data-lucide="sun" width="16" height="16"></i><span class="bottom-prayer-name">Dhuhr</span></div><div class="bottom-prayer-time" id="timeDhuhr">--:--</div></div>
          <div class="bottom-prayer-card"><div class="bottom-prayer-header"><i data-lucide="sun" width="16" height="16"></i><span class="bottom-prayer-name">Asr</span></div><div class="bottom-prayer-time" id="timeAsr">--:--</div></div>
          <div class="bottom-prayer-card"><div class="bottom-prayer-header"><i data-lucide="sunset" width="16" height="16"></i><span class="bottom-prayer-name">Maghrib</span></div><div class="bottom-prayer-time" id="timeMaghrib">--:--</div></div>
          <div class="bottom-prayer-card"><div class="bottom-prayer-header"><i data-lucide="moon" width="16" height="16"></i><span class="bottom-prayer-name">Isha</span></div><div class="bottom-prayer-time" id="timeIsha">--:--</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Script -->
  <script>
    /* ================= Utils ================ */
    const $ = id => document.getElementById(id);
    const state = { lat: null, lon: null, times: {}, nextPrayer: null };

    const getDateDMY = () => {
      const d = new Date();
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      return `${dd}-${mm}-${d.getFullYear()}`;
    };

    /* ========== API Call (AlAdhan /timings/{date}) ========= */
    async function fetchPrayerTimes(method = 4) {
      if (state.lat === null) return;
      const dateStr = getDateDMY();           // DD-MM-YYYY
      const url = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${state.lat}&longitude=${state.lon}&method=${method}&timezonestring=Asia/Riyadh`;
      const resp = await fetch(url);
      const json = await resp.json();
      state.times = json.data.timings;
      renderPrayerTimes();
      computeNextPrayerCountdown();
    }

    /* ========== Reverse-geocode city name ========= */
    async function reverseGeocode() {
      const resp = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${state.lat}&longitude=${state.lon}&localityLanguage=en`);
      const loc = await resp.json();
      $('cityName').textContent = loc.city || loc.locality || 'Your City';
    }

    /* ========== Render prayer times ========= */
    function renderPrayerTimes() {
      const map = {Fajr:'timeFajr',Sunrise:'timeSunrise',Dhuhr:'timeDhuhr',Asr:'timeAsr',Maghrib:'timeMaghrib',Isha:'timeIsha'};
      Object.entries(map).forEach(([p,id])=>{
        $(id).textContent = (state.times[p]||'--:--').replace(/ \\(.*\\)/,'');
      });
      $('currentPrayer').textContent = getCurrentPrayerName();
    }

    /* ========== Determine current & next prayer ========== */
    const order = ['Fajr','Sunrise','Dhuhr','Asr','Maghrib','Isha'];
    const toDate = (t,base) => new Date(`${base}T${t}:00`);

    function getCurrentPrayerName() {
      const now = new Date();
      const today = now.toISOString().slice(0,10);
      let current = order[order.length-1];
      for (const p of order) {
        const t = toDate(state.times[p], today);
        if (now >= t) current = p;
      }
      return current;
    }

    function computeNextPrayerCountdown() {
      const now = new Date();
      const today = now.toISOString().slice(0,10);
      let next = null;
      for (const p of order) {
        const t = toDate(state.times[p], today);
        if (t > now) { next = { name:p, time:t }; break; }
      }
      if (!next) { // tomorrow's Fajr
        const d = new Date(now.getTime()+86400000);
        const nextFajr = toDate(state.times.Fajr, d.toISOString().slice(0,10));
        next = { name:'Fajr', time: nextFajr };
      }
      state.nextPrayer = next;
      $('nextPrayerLabel').textContent = `Next (${next.name}) in`;
    }

    function tickCountdown() {
      if (!state.nextPrayer) return;
      const diff = state.nextPrayer.time - new Date();
      if (diff <= 0) { fetchPrayerTimes(); return; }
      const h = Math.floor(diff/3600000);
      const m = Math.floor((diff%3600000)/60000);
      const s = Math.floor((diff%60000)/1000);
      $('countdown').textContent = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    /* ========== Dates (Gregorian + Hijri) ========== */
    function initDates() {
      const now = new Date();
      $('gregorianDate').textContent = now.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
      $('islamicDate').textContent = now.toLocaleDateString('ar-SA-u-ca-islamic',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
    }

    /* ========== Geolocation Bootstrap ========== */
    function locateAndLoad() {
      if (!navigator.geolocation) { alert('Geolocation not supported'); return; }
      navigator.geolocation.getCurrentPosition(async pos=>{
        state.lat = pos.coords.latitude;
        state.lon = pos.coords.longitude;
        await reverseGeocode();
        await fetchPrayerTimes();
      }, err=>alert('Location error: '+err.message));
    }

    document.addEventListener('DOMContentLoaded',()=>{
      lucide.createIcons();
      initDates();
      locateAndLoad();
      setInterval(tickCountdown,1000);
    });
  </script>
</body>
</html>
